---
import { getCollection, type CollectionEntry } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";

import Layout from "../../../layouts/Layout.astro";
import BlogPost from "../../../components/BlogPost.astro";
import { buildTagPaths } from "@/utils/core/routing/urlBuilders.ts";
import { neutralizePath } from "@/utils/core/i18n/locale/path.ts";
import { metaLoader } from "@/utils/core/i18n/dict/dictBuilder.ts";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  return buildTagPaths(allPosts);
}

const { lang } = Astro.params;
const { tag, posts } = Astro.props as { tag: string; posts: CollectionEntry<"blog">[] };
const meta = await metaLoader.getAsync(lang);
const title = meta["tags:page"].title;
const description = meta["tags:page"].description;
---

<Layout pageTitle={title} description={description}>
  <h1>Posts tagged with {tag}</h1>
  <ul aria-label="Tagged Posts">
    {
      posts.map((post) => (
        <BlogPost
          url={getRelativeLocaleUrl(lang, `blog${neutralizePath(post.id)}`)}
          title={post.data.title}
        />
      ))
    }
  </ul>
</Layout>

---
import Layout from '../../../layouts/Layout.astro'
import BlogPost from '../../../components/BlogPost.astro'
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import { buildTagPaths, buildBlogPostPath, metaLoader, type Locale } from "@/i18n";

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  return buildTagPaths(allPosts);
}

const { lang } = Astro.params;
const { tag, posts } = Astro.props as { tag: string; posts: CollectionEntry<'blog'>[] }
const meta = await metaLoader.getAsync(lang);
const title = meta['tags:page'].title;
const description = meta['tags:page'].description;
---

<Layout pageTitle={title} description={description}>
  <h1>Posts tagged with {tag}</h1>
  <ul aria-label="Tagged Posts">
    {posts.map((post) => (
      <BlogPost url={buildBlogPostPath(lang as Locale, post.id)} title={post.data.title} />
    ))}
  </ul>
</Layout>
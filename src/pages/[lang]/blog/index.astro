---
import Layout from "../../../layouts/Layout.astro";
import BlogPost from "../../../components/BlogPost.astro";
import { getCollection } from "astro:content";
import { type Locale, byLang, buildBlogPostPath, pathsForAllLocales, metaLoader } from "@/utils";

export function getStaticPaths() {
  return pathsForAllLocales();
}

const lang = Astro.params.lang as Locale;
const meta = await metaLoader.getAsync(lang);
const title = meta["blog:index"].title;
const description = meta["blog:index"].description;

const allPosts = await getCollection("blog", byLang(lang));
---

<Layout pageTitle={title} description={description}>
  <h1>{title}</h1>
  <ul aria-label="Blog Posts">
    {
      allPosts.map((post) => (
        <BlogPost url={buildBlogPostPath(lang, post.id)} title={post.data.title} />
      ))
    }
  </ul>
</Layout>

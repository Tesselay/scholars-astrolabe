---
import Layout from '../../../layouts/Layout.astro'
import BlogPost from '../../../components/BlogPost.astro'
import { getCollection } from 'astro:content'
import { type Locale, byLang, buildBlogPostPath, pathsForAllLocales, getPageMetaAsync } from "@/i18n";

export function getStaticPaths() {
  return pathsForAllLocales();
}

const lang = Astro.params.lang as Locale;
const meta = await getPageMetaAsync(lang, "blog:index");

const allPosts = await getCollection('blog', byLang(lang));
---

<Layout pageTitle={meta.title} description={meta.description} >
  <h1>{meta.title}</h1>
  <ul aria-label="Blog Posts">
    {allPosts.map((post) => (
      <BlogPost
        url={buildBlogPostPath(lang, post.id)}
        title={post.data.title}
      />
    ))}
  </ul>
</Layout>
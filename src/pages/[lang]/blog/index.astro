---
import { getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import Layout from "../../../layouts/Layout.astro";
import BlogPost from "../../../components/BlogPost.astro";
import { neutralizePath } from "@/utils/core/i18n/locale/path.ts";
import { metaLoader } from "@/utils/core/i18n/dict/dictBuilder.ts";
import { byLang } from "@/utils/content/filter";
import { pathsForAllLocales } from "@/utils/core/routing/routes.ts";

export function getStaticPaths() {
  return pathsForAllLocales();
}

const lang = Astro.currentLocale;
const meta = await metaLoader.getAsync(lang);
const title = meta["blog:index"].title;
const description = meta["blog:index"].description;

const allPosts = await getCollection("blog", byLang(lang));
---

<Layout pageTitle={title} description={description}>
  <h1>{title}</h1>
  <ul aria-label="Blog Posts">
    {
      allPosts.map((post) => (
        <BlogPost
          url={getRelativeLocaleUrl(lang, `blog${neutralizePath(post.id)}`)}
          title={post.data.title}
        />
      ))
    }
  </ul>
</Layout>
